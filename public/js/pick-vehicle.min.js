(function ($) {
    var $field1,
        $field2,
        $field3,
        $vehicleForm,
        formOptionValue,
        formSelectedName,
        $brandList, brandItems,
        $modelList, modelItems,
        $yearList, yearItems,
        formAction;

    function onFormFieldClick(e) {
        formOptionValue = e.target.value;
        formSelectedName = e.target.name;

        if(formOptionValue == 'select') return;

        switch (formSelectedName) {
        case 'type':
            $field1.prop('disabled', true);
            $field1.empty();
            formData = $('#vehicle_form').serializeArray();
            formData.push({name: 'select', value: ['brand']});
            brandItems = [];

            $.post(formAction, formData, function (data){
                brandItems.push('<option value='select' selected='true' disabled='disabled'>select</option>');

                $.each(data, function(index, value){
                    brandItems.push('<option value=''+value.brand+''>'+value.brand+'</option>');
                });

                $brandList.append(brandItems.join(''));
                $brandList.prop('disabled', false);

            });
           break;
        case 'brand':
            $field2.prop('disabled', true);
            $field2.empty();
            formData = $('#vehicle_form').serializeArray();
            formData.push({name: 'select', value: ['model']});
            modelItems = [];

            $.post(formAction, formData, function (data){
                modelItems.push('<option value='select' selected='true' disabled='disabled'>select</option>');

                $.each(data, function(index, value){
                    modelItems.push('<option value=''+value.model+''>'+value.model+'</option>');
                });

                $modelList.append(modelItems.join(''));
                $modelList.prop('disabled', false);

            });
           break;
        case 'model':
            $field3.prop('disabled', true);
            $field3.empty();
            formData = $('#vehicle_form').serializeArray();
            formData.push({name: 'select', value: ['id', 'produced_from', 'produced_to']});
            yearItems = [];

            $.post(formAction, formData, function (data){
                yearItems.push('<option value='select' selected='true' disabled='disabled'>select</option>');

                $.each(data, function(index, value){
                    yearItems.push('<option value=''+value.id+'' id=''+value.id+''>'+value.produced_from+'-'+value.produced_to+'</option>');
                });

                $yearList.append(yearItems.join(''));
                $yearList.prop('disabled', false);

            });
           break;
        case 'year':
           break;
        default:

        }
    }

    function bindings() {
        $vehicleForm.on('change', onFormFieldClick);
    }

    $( document ).ready( function()
    {
        $brandList = $('#brand');
        $modelList = $('#model');
        $yearList = $('#year');
        $vehicleForm = $('#type, #brand, #model, #year');
        $field1 = $('#brand, #model, #year');
        $field2 = $('#model, #year');
        $field3 = $('#year');
        formAction = $('#vehicle_form').attr('action');
        bindings();
    });
})(jQuery);
